<div class="container mt-5">
  <div class="row">
    <!-- Offene Tickets -->
    <div class="col-md-6">
      <h2 class="text-primary mb-4"><i class="fas fa-hourglass-start"></i> Offene Tickets</h2>
      <ul class="list-group mb-4">
        <li
          *ngFor="let ticket of offeneTickets"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          (click)="selectTicket(ticket)"
        >
          <span>
            <i class="fas fa-ticket-alt me-2"></i>{{ ticket.titel }}
          </span>
          <span class="badge bg-primary rounded-pill">{{ ticket.erstellungsdatum | date: 'short' }}</span>
        </li>
      </ul>
    </div>

    <!-- Geschlossene Tickets -->
    <div class="col-md-6">
      <h2 class="text-secondary mb-4"><i class="fas fa-check-circle"></i> Geschlossene Tickets</h2>
      <ul class="list-group mb-4">
        <li
          *ngFor="let ticket of geschlosseneTickets"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          (click)="selectTicket(ticket)"
        >
          <span>
            <i class="fas fa-ticket-alt me-2"></i>{{ ticket.titel }}
          </span>
          <span class="badge bg-secondary rounded-pill">{{ ticket.erstellungsdatum | date: 'short' }}</span>
        </li>
      </ul>
    </div>
  </div>

  <!-- Ticket Details -->
  <div *ngIf="selectedTicket" class="card mt-4">
    <div class="card-header bg-info text-white">
      <h4><i class="fas fa-info-circle"></i> Details für Ticket #{{ selectedTicket.id }}</h4>
    </div>
    <div class="card-body">
      <p><strong>Titel:</strong> {{ selectedTicket.titel }}</p>
      <p><strong>Beschreibung:</strong> {{ selectedTicket.beschreibung }}</p>
      <p><strong>Stufe:</strong> {{ getLevelDescription(selectedTicket.prioritaet) }}</p>
      <p>
        <strong>Status:</strong>
        <span
          class="badge"
          [ngClass]="{
            'bg-success': selectedTicket.status?.toLowerCase() === 'geschlossen',
            'bg-warning text-dark': selectedTicket.status?.toLowerCase() === 'offen'
          }"
        >
          {{ selectedTicket.status || 'Unbekannt' }}
        </span>
      </p>

      <button
        *ngIf="selectedTicket && selectedTicket.status"
        class="btn mt-3 mb-4 px-4 py-2"
        [ngClass]="{
          'btn-danger': selectedTicket.status === 'offen',
          'btn-success': selectedTicket.status === 'geschlossen'
        }"
        (click)="toggleTicketStatus()"
      >
        <i class="fas fa-exchange-alt"></i> Status ändern zu "{{ selectedTicket.status === 'offen' ? 'geschlossen' : 'offen' }}"
      </button>

      <p>
        <strong>Erstellungsdatum:</strong>
        {{ selectedTicket.erstellungsdatum | date: 'short' }}
      </p>
      <p>
        <strong>Schließungsdatum:</strong>
        {{ selectedTicket.schlussdatum || 'Nicht geschlossen' }}
      </p>

      <!-- Bilder anzeigen -->
      <div *ngIf="selectedTicket.images && selectedTicket.images.length > 0" class="mb-4">
        <h5><i class="fas fa-images"></i> Bilder</h5>
        <div class="ticket-images">
          <img
            *ngFor="let image of selectedTicket.images"
            [src]="'data:' + getImageMimeType(image.filename) + ';base64,' + image.data"
            [alt]="image.filename"
            class="img-thumbnail ticket-image"
          />
        </div>
      </div>

      <hr />

      <!-- Kommentare -->
      <h5><i class="fas fa-comments"></i> Kommentare</h5>
      <ul
        *ngIf="selectedTicket.kommentare && selectedTicket.kommentare.length > 0"
        class="list-group mb-3"
      >
        <li *ngFor="let comment of selectedTicket.kommentare" class="list-group-item">
          <strong>{{ comment.autor }}:</strong> {{ comment.inhalt }}
          <br />
          <small class="text-muted">{{ comment.zeitstempel | date: 'short' }}</small>
        </li>
      </ul>
      <p
        *ngIf="!selectedTicket.kommentare || selectedTicket.kommentare.length === 0"
        class="text-muted"
      >
        Keine Kommentare vorhanden.
      </p>

      <!-- Neuen Kommentar hinzufügen -->
      <div class="form-group">
        <label for="newComment"><i class="fas fa-edit"></i> Neuen Kommentar hinzufügen:</label>
        <textarea
          id="newComment"
          class="form-control"
          [(ngModel)]="newCommentContent"
          rows="3"
          placeholder="Geben Sie Ihren Kommentar ein"
        ></textarea>
        <button class="btn btn-primary mt-2" (click)="addComment()">
          <i class="fas fa-paper-plane"></i> Kommentar hinzufügen
        </button>
      </div>
    </div>
  </div>
</div>
